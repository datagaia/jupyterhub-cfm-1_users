## Shared Policy
	  ##########################################################
	  #
	  # List access for all bucket names and datalake bucket root. 
	  # Read/write access for <datalake-bucket>/shared/*. 
	  # Write access to Logs.
	  #
	  
	  SharedPolicy:
	    Type: AWS::IAM::ManagedPolicy
	    Properties: 
	      Description: String
	      PolicyDocument:
	        Version: "2012-10-17"
	        Statement:
	          - Effect: Allow
	            Action:
	              - logs:CreateLogGroup
	              - logs:CreateLogStream
	              - logs:PutLogEvents
	              - logs:DescribeLogStreams
	            Resource:
	              - "*"
	          - Effect: Allow
	            Action:
	              - s3:ListAllMyBuckets
	              - s3:GetBucketLocation
	            Resource: 
	              - "*"
	          - Effect: Allow
	            Action:
	              - s3:ListBucket
	            Resource: 
	              - !Join
	                - ''
	                - - 'arn:aws:s3:::'
	                  - !ImportValue JupyterHub-DataLakeBucketName
	            Condition:
	              StringEquals:
	                s3:prefix:
	                  - ""
	                  - "shared/"
	                s3:delimiter: "/"
	          - Effect: Allow
	            Action:
	              - s3:ListBucket
	            Resource: 
	              - !Join
	                - ''
	                - - 'arn:aws:s3:::'
	                  - !ImportValue JupyterHub-DataLakeBucketName
	            Condition:
	              StringLike:
	                s3:prefix: 
	                  - "shared/*"
	          - Effect: Allow
	            Action:
	              - 's3:*'
	            Resource:
	              - !Join
	                - ''
	                - - 'arn:aws:s3:::'
	                  - !ImportValue JupyterHub-DataLakeBucketName
	                  - '/shared/*'
	      Roles:
	{%- for user in shared_users %}
	        - ADFS-{{user["resource"]}}
	{%- endfor %}
	      Users:
	{%- for user in shared_users %}
	        - {{user["aws_username"]}}
	{%- endfor %}
	      ManagedPolicyName: SharedPolicy
